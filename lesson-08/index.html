<!doctype html>
<html lang="en">
 <head>
   <link rel="stylesheet" href="../assets/brand.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fruit Addition Adventure</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #FF6B9D 0%, #4ECDC4 25%, #45B7D1 50%, #96CEB4 75%, #FFEAA7 100%);
            min-height: 100%;
            overflow-x: hidden;
        }

        html {
            height: 100%;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            min-height: 100%;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .title {
            font-size: 2.5rem;
            color: #FF6B6B;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin: 20px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #FFE5CC;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            border: 3px solid #FF9F43;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ECDC4, #44A08D);
            border-radius: 12px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .fruit-area {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 4px solid #FFE5CC;
        }

        .fruit-group {
            display: inline-flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 10px 20px;
            vertical-align: middle;
        }

        .fruit-emoji {
            font-size: 4.5rem;
            margin: 8px;
            animation: wiggle 2s ease-in-out infinite;
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }

        .plus-sign {
            font-size: 4rem;
            color: #FF6B6B;
            margin: 0 20px;
            vertical-align: middle;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .number-bond {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 30px 0;
            gap: 20px;
        }

        .bond-top-row {
            display: flex;
            gap: 40px;
            align-items: center;
        }

        .bond-bottom-row {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .bond-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .bond-part {
            background: linear-gradient(135deg, #00D2FF, #3A7BD5);
            border: 4px solid #0984E3;
        }

        .bond-whole {
            background: linear-gradient(135deg, #FF9500, #FF6B35);
            border: 4px solid #E17055;
            width: 100px;
            height: 100px;
            font-size: 2.5rem;
        }

        .question-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .question-text {
            font-size: 1.8rem;
            color: #2C3E50;
            background: #FFF9E6;
            padding: 15px;
            border-radius: 15px;
            border: 3px solid #F39C12;
            flex: 1;
            max-width: 600px;
        }

        .audio-icon {
            background: linear-gradient(135deg, #9B59B6, #8E44AD);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #7D3C98;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .audio-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }

        .answer-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .answer-btn {
            background: linear-gradient(135deg, #74B9FF, #0984E3);
            color: white;
            border: none;
            padding: 20px 30px;
            border-radius: 20px;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid #0984E3;
            min-width: 80px;
        }

        .answer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(116, 185, 255, 0.4);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #00B894, #00A085);
            border-color: #00A085;
            animation: correctPop 0.6s ease;
        }

        .answer-btn.incorrect {
            background: linear-gradient(135deg, #E17055, #D63031);
            border-color: #D63031;
            animation: shake 0.6s ease;
        }

        @keyframes correctPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .feedback {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 15px;
            min-height: 50px;
        }

        .feedback.correct {
            color: #00B894;
            background: #E8F8F5;
            border: 3px solid #00B894;
        }

        .feedback.incorrect {
            color: #E17055;
            background: #FDF2F2;
            border: 3px solid #E17055;
        }

        .next-btn {
            background: linear-gradient(135deg, #FD79A8, #E84393);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 25px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid #E84393;
            display: none;
        }

        .next-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(253, 121, 168, 0.4);
        }

        .gift-boxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .gift-box {
            background: linear-gradient(135deg, #FF7675, #E17055);
            border: 4px solid #D63031;
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 3rem;
        }

        .gift-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 118, 117, 0.4);
        }

        .gift-box.opened {
            background: linear-gradient(135deg, #FDCB6E, #E17055);
            animation: giftOpen 0.8s ease;
        }

        @keyframes giftOpen {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .sticker-reveal {
            background: white;
            border: 4px solid #FDCB6E;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            font-size: 1.5rem;
            color: #2C3E50;
        }

        .dancing-fruits {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .dancing-fruit {
            font-size: 4rem;
            animation: dance 1s ease-in-out infinite;
        }

        .dancing-fruit:nth-child(2) { animation-delay: 0.2s; }
        .dancing-fruit:nth-child(3) { animation-delay: 0.4s; }
        .dancing-fruit:nth-child(4) { animation-delay: 0.6s; }
        .dancing-fruit:nth-child(5) { animation-delay: 0.8s; }

        @keyframes dance {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(-10px) rotate(-5deg); }
            75% { transform: translateY(-15px) rotate(3deg); }
        }

        .confetti {
            position: fixed;
            top: -10px;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #FF6B6B;
            animation: confettiFall 3s linear infinite;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        .celebration-title {
            font-size: 3rem;
            color: #FF6B6B;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
            margin: 30px 0;
            animation: celebrationBounce 1s ease-in-out infinite;
        }

        @keyframes celebrationBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 600px) {
            .title { font-size: 2rem; }
            .fruit-emoji { font-size: 3.5rem; }
            .plus-sign { font-size: 3rem; }
            .answer-btn { padding: 15px 20px; font-size: 1.5rem; }
            .celebration-title { font-size: 2.2rem; }
            .question-container { flex-direction: column; gap: 10px; }
            .question-text { max-width: 100%; }
            .bond-top-row { gap: 20px; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
   <img src="../assets/logo-oodles-math.png" class="oodles-logo">
  <div class="container"><!-- Question Screen -->
   <div id="questionScreen" class="screen active">
    <h1 id="gameTitle" class="title">Fruit Addition Adventure!</h1>
    <div class="progress-bar">
     <div id="progressFill" class="progress-fill"></div>
    </div>
    <div class="fruit-area">
     <div id="fruitDisplay"></div>
     <div id="numberBond" class="number-bond" style="display: none;">
      <div class="bond-top-row">
       <div class="bond-circle bond-part" id="bondPart1">
        ?
       </div>
       <div class="bond-circle bond-part" id="bondPart2">
        ?
       </div>
      </div>
      <div class="bond-bottom-row">
       <div class="bond-circle bond-whole" id="bondWhole">
        ?
       </div>
      </div>
     </div>
    </div>
    <div class="question-container">
     <div id="questionText" class="question-text">
      How many fruits do you see?
     </div><button class="audio-icon" onclick="playAudio()">üîä</button>
    </div>
    <div id="answerButtons" class="answer-buttons"></div>
    <div id="feedback" class="feedback"></div><button id="nextBtn" class="next-btn" onclick="nextStep()">Next Step! ‚ú®</button>
   </div><!-- Gift Screen -->
   <div id="giftScreen" class="screen">
    <h1 class="title">Great job! Choose your mystery gift! üéÅ</h1>
    <div class="gift-boxes" id="giftBoxes">
     <div class="gift-box" onclick="openGift(0)">
      üéÅ
     </div>
     <div class="gift-box" onclick="openGift(1)">
      üéÅ
     </div>
     <div class="gift-box" onclick="openGift(2)">
      üéÅ
     </div>
     <div class="gift-box" onclick="openGift(3)">
      üéÅ
     </div>
    </div>
    <div id="stickerReveal" class="sticker-reveal" style="display: none;"></div><button id="continueBtn" class="next-btn" onclick="continueGame()" style="display: none;">Continue Adventure! ‚ú®</button>
   </div><!-- Celebration Screen -->
   <div id="celebrationScreen" class="screen">
    <div class="confetti" id="confetti"></div>
    <h1 class="celebration-title">You are a Fruit Math Champion!</h1>
    <div class="dancing-fruits">
     <div class="dancing-fruit">
      üçé
     </div>
     <div class="dancing-fruit">
      üçå
     </div>
     <div class="dancing-fruit">
      üçä
     </div>
     <div class="dancing-fruit">
      üçá
     </div>
     <div class="dancing-fruit">
      üçì
     </div>
    </div>
    <div id="encouragementMessage" style="font-size: 1.5rem; color: #2C3E50; margin: 20px 0; background: #FFF9E6; padding: 20px; border-radius: 15px; border: 3px solid #F39C12;">
     Great job! You're doing amazing!
    </div><button class="next-btn" onclick="restartGame()" style="display: block;">Play Again! üéÆ</button>
   </div>
  </div>
  <script>
        // Game state
        let currentQuestion = 0;
        let currentStep = 0; // 0: first group, 1: second group, 2: addition
        let totalQuestions = 5;
        let questions = [];
        let currentAnswers = [];

        // Configuration
        const defaultConfig = {
            game_title: "Fruit Addition Adventure!",
            encouragement_text: "Great job! You're doing amazing!"
        };

        // Fruits array
        const fruits = ['üçé', 'üçå', 'üçä', 'üçá', 'üçì', 'ü•ù', 'üçí', 'ü•≠'];
        const stickers = ['‚≠ê', 'üíñ', 'üèÜ', 'üéñÔ∏è', 'üåü', 'üíé', 'üéä', 'üéâ'];

        // Initialize game
        function initGame() {
            generateQuestions();
            showQuestion();
        }

        function generateQuestions() {
            questions = [];
            for (let i = 0; i < totalQuestions; i++) {
                const fruit1 = fruits[Math.floor(Math.random() * fruits.length)];
                let fruit2 = fruits[Math.floor(Math.random() * fruits.length)];
                while (fruit2 === fruit1) {
                    fruit2 = fruits[Math.floor(Math.random() * fruits.length)];
                }
                
                // Generate numbers that sum to max 20
                let count1, count2;
                do {
                    count1 = Math.floor(Math.random() * 15) + 1; // 1-15
                    count2 = Math.floor(Math.random() * 15) + 1; // 1-15
                } while (count1 + count2 > 20); // Ensure sum doesn't exceed 20
                
                questions.push({
                    fruit1: fruit1,
                    fruit2: fruit2,
                    count1: count1,
                    count2: count2,
                    total: count1 + count2
                });
            }
        }

        function showQuestion() {
            const question = questions[currentQuestion];
            currentAnswers = [];
            
            // Update progress
            const progress = (currentQuestion / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Reset UI
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('numberBond').style.display = 'none';
            
            showStep();
        }

        function showStep() {
            const question = questions[currentQuestion];
            const fruitDisplay = document.getElementById('fruitDisplay');
            const questionText = document.getElementById('questionText');
            
            if (currentStep === 0) {
                // Show first fruit group
                let fruitHTML = '';
                for (let i = 0; i < question.count1; i++) {
                    fruitHTML += `<span class="fruit-emoji">${question.fruit1}</span>`;
                }
                fruitDisplay.innerHTML = `
                    <div class="fruit-group">
                        ${fruitHTML}
                    </div>
                `;
                questionText.textContent = `How many ${getFruitName(question.fruit1)} do you see?`;
                generateAnswerButtons(question.count1);
                
            } else if (currentStep === 1) {
                // Show second fruit group
                let fruitHTML = '';
                for (let i = 0; i < question.count2; i++) {
                    fruitHTML += `<span class="fruit-emoji">${question.fruit2}</span>`;
                }
                fruitDisplay.innerHTML = `
                    <div class="fruit-group">
                        ${fruitHTML}
                    </div>
                `;
                questionText.textContent = `How many ${getFruitName(question.fruit2)} do you see?`;
                generateAnswerButtons(question.count2);
                
            } else if (currentStep === 2) {
                // Show both groups with addition
                let fruit1HTML = '';
                for (let i = 0; i < question.count1; i++) {
                    fruit1HTML += `<span class="fruit-emoji">${question.fruit1}</span>`;
                }
                let fruit2HTML = '';
                for (let i = 0; i < question.count2; i++) {
                    fruit2HTML += `<span class="fruit-emoji">${question.fruit2}</span>`;
                }
                fruitDisplay.innerHTML = `
                    <div class="fruit-group">
                        ${fruit1HTML}
                    </div>
                    <div class="plus-sign">+</div>
                    <div class="fruit-group">
                        ${fruit2HTML}
                    </div>
                `;
                
                // Show number bond
                document.getElementById('numberBond').style.display = 'flex';
                document.getElementById('bondPart1').textContent = question.count1;
                document.getElementById('bondPart2').textContent = question.count2;
                document.getElementById('bondWhole').textContent = '?';
                
                questionText.textContent = 'How many fruits altogether?';
                generateAnswerButtons(question.total);
            }
        }

        function getFruitName(emoji) {
            const names = {
                'üçé': 'apples', 'üçå': 'bananas', 'üçä': 'oranges', 
                'üçá': 'grapes', 'üçì': 'strawberries', 'ü•ù': 'kiwis', 
                'üçí': 'cherries', 'ü•≠': 'mangoes'
            };
            return names[emoji] || 'fruits';
        }

        function generateAnswerButtons(correctAnswer) {
            const buttonsContainer = document.getElementById('answerButtons');
            buttonsContainer.innerHTML = '';
            
            // Generate 3 answer options
            const answers = [correctAnswer];
            while (answers.length < 3) {
                // Generate wrong answers within reasonable range (1-25)
                const wrongAnswer = Math.floor(Math.random() * 25) + 1;
                if (!answers.includes(wrongAnswer)) {
                    answers.push(wrongAnswer);
                }
            }
            
            // Shuffle answers
            answers.sort(() => Math.random() - 0.5);
            
            answers.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer;
                button.onclick = () => checkAnswer(answer, correctAnswer, button);
                buttonsContainer.appendChild(button);
            });
        }

        function checkAnswer(selected, correct, button) {
            const feedback = document.getElementById('feedback');
            const buttons = document.querySelectorAll('.answer-btn');
            
            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);
            
            if (selected === correct) {
                // Play success sound effect
                playSuccessSound();
                
                button.classList.add('correct');
                feedback.textContent = 'üéâ Fantastic! You got it right!';
                feedback.className = 'feedback correct';
                
                currentAnswers.push(selected);
                
                // Update number bond if on addition step
                if (currentStep === 2) {
                    document.getElementById('bondWhole').textContent = correct;
                }
                
                setTimeout(() => {
                    if (currentStep < 2) {
                        currentStep++;
                        showStep();
                    } else {
                        // Question complete, show gift screen
                        currentStep = 0;
                        showScreen('giftScreen');
                    }
                }, 1500);
                
            } else {
                // Play error sound effect
                playErrorSound();
                
                button.classList.add('incorrect');
                feedback.textContent = 'Try again!';
                feedback.className = 'feedback incorrect';
                
                setTimeout(() => {
                    button.classList.remove('incorrect');
                    buttons.forEach(btn => btn.disabled = false);
                    feedback.textContent = '';
                    feedback.className = 'feedback';
                }, 1000);
            }
        }

        function nextStep() {
            currentStep++;
            showStep();
            document.getElementById('nextBtn').style.display = 'none';
        }

        function nextQuestion() {
            currentQuestion++;
            currentStep = 0;
            
            if (currentQuestion < totalQuestions) {
                showQuestion();
            } else {
                showCelebration();
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function openGift(index) {
            const giftBoxes = document.querySelectorAll('.gift-box');
            const selectedBox = giftBoxes[index];
            
            // Disable all boxes
            giftBoxes.forEach(box => box.onclick = null);
            
            // Open selected box
            selectedBox.classList.add('opened');
            const randomSticker = stickers[Math.floor(Math.random() * stickers.length)];
            selectedBox.textContent = randomSticker;
            
            // Show sticker reveal
            const stickerReveal = document.getElementById('stickerReveal');
            stickerReveal.innerHTML = `üéâ You got a ${randomSticker} sticker! Well done! üéâ`;
            stickerReveal.style.display = 'block';
            
            // Show continue button
            setTimeout(() => {
                document.getElementById('continueBtn').style.display = 'block';
            }, 1000);
        }

        function continueGame() {
            // Reset gift screen
            const giftBoxes = document.querySelectorAll('.gift-box');
            giftBoxes.forEach((box, index) => {
                box.classList.remove('opened');
                box.textContent = 'üéÅ';
                box.onclick = () => openGift(index);
            });
            document.getElementById('stickerReveal').style.display = 'none';
            document.getElementById('continueBtn').style.display = 'none';
            
            // Move to next question
            currentQuestion++;
            currentStep = 0;
            
            if (currentQuestion < totalQuestions) {
                showScreen('questionScreen');
                showQuestion();
            } else {
                showCelebration();
            }
        }

        function showCelebration() {
            showScreen('celebrationScreen');
            createConfetti();
        }

        function createConfetti() {
            const confettiContainer = document.getElementById('confetti');
            confettiContainer.innerHTML = '';
            
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
            
            for (let i = 0; i < 50; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.className = 'confetti-piece';
                confettiPiece.style.left = Math.random() * 100 + '%';
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confettiPiece.style.animationDelay = Math.random() * 3 + 's';
                confettiPiece.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confettiContainer.appendChild(confettiPiece);
            }
        }

        function playSuccessSound() {
            // Create success sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                console.log('Audio not supported, using visual feedback');
            }
            
            // Visual feedback for success
            const audioIcon = document.querySelector('.audio-icon');
            audioIcon.style.background = 'linear-gradient(135deg, #00B894, #00A085)';
            audioIcon.textContent = 'üéµ';
            
            setTimeout(() => {
                audioIcon.style.background = 'linear-gradient(135deg, #9B59B6, #8E44AD)';
                audioIcon.textContent = 'üîä';
            }, 500);
        }

        function playErrorSound() {
            // Create error sound using Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (error) {
                console.log('Audio not supported, using visual feedback');
            }
            
            // Visual feedback for error
            const audioIcon = document.querySelector('.audio-icon');
            audioIcon.style.background = 'linear-gradient(135deg, #E17055, #D63031)';
            audioIcon.textContent = '‚ùå';
            
            setTimeout(() => {
                audioIcon.style.background = 'linear-gradient(135deg, #9B59B6, #8E44AD)';
                audioIcon.textContent = 'üîä';
            }, 500);
        }

        function playAudio() {
            // Read the question text aloud using Speech Synthesis API
            const questionText = document.getElementById('questionText').textContent;
            
            try {
                if ('speechSynthesis' in window) {
                    // Cancel any ongoing speech
                    window.speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(questionText);
                    utterance.rate = 0.8; // Slower for kids
                    utterance.pitch = 1.2; // Higher pitch for friendliness
                    utterance.volume = 0.8;
                    
                    // Visual feedback
                    const audioBtn = document.querySelector('.audio-icon');
                    if (audioBtn) {
                        audioBtn.style.transform = 'scale(0.95)';
                        audioBtn.textContent = 'üéµ';
                        audioBtn.style.background = 'linear-gradient(135deg, #00B894, #00A085)';
                        
                        utterance.onend = () => {
                            audioBtn.style.transform = 'scale(1)';
                            audioBtn.textContent = 'üîä';
                            audioBtn.style.background = 'linear-gradient(135deg, #9B59B6, #8E44AD)';
                        };
                        
                        window.speechSynthesis.speak(utterance);
                    }
                } else {
                    throw new Error('Speech synthesis not supported');
                }
            } catch (error) {
                console.log('Speech synthesis not supported, using visual feedback');
                // Fallback visual feedback
                const audioBtn = document.querySelector('.audio-icon');
                if (audioBtn) {
                    audioBtn.style.transform = 'scale(0.95)';
                    audioBtn.textContent = 'üéµ';
                    
                    setTimeout(() => {
                        audioBtn.style.transform = 'scale(1)';
                        audioBtn.textContent = 'üîä';
                    }, 1000);
                }
            }
        }

        function restartGame() {
            currentQuestion = 0;
            currentStep = 0;
            showScreen('questionScreen');
            initGame();
        }

        // Element SDK Integration
        async function onConfigChange(config) {
            const gameTitle = config.game_title || defaultConfig.game_title;
            const encouragementText = config.encouragement_text || defaultConfig.encouragement_text;
            
            document.getElementById('gameTitle').textContent = gameTitle;
            document.getElementById('encouragementMessage').textContent = encouragementText;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["game_title", config.game_title || defaultConfig.game_title],
                ["encouragement_text", config.encouragement_text || defaultConfig.encouragement_text]
            ]);
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // Start the game
        initGame();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b5ae007e1d43bdd',t:'MTc2NzAyNzg1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
