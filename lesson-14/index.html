<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="../assets/brand.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What time is it? (O'clock)</title>
    <!-- Tailwind CSS for layout and styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font - Fredoka is rounded and friendly for kids */
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #FFF5F5; /* Warmer background */
            /* Colorful playful background pattern */
            background-image: 
                radial-gradient(#FF9F1C 15%, transparent 16%), 
                radial-gradient(#2EC4B6 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            user-select: none;
            overflow: hidden; /* Prevent scrolling during game */
        }

        /* Animations */
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        .animate-wiggle {
            animation: wiggle 0.3s ease-in-out infinite;
        }

        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* Clock Hand Transition */
        #hour-hand {
            transition: transform 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: 100px 100px;
        }

        /* Button Hover Effects */
        .game-btn {
            transition: all 0.1s;
            border-bottom-width: 6px;
        }
        .game-btn:active {
            transform: translateY(4px);
            border-bottom-width: 0px;
            margin-bottom: 6px;
        }

        /* Candy Game Styles */
        .candy {
            position: absolute;
            font-size: 2rem;
            animation: spin 2s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        #basket {
            position: absolute;
            bottom: 20px;
            font-size: 4rem;
            transform: translateX(-50%);
            transition: left 0.1s ease-out;
            pointer-events: none; /* Let clicks pass through if needed */
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative text-gray-800">
<link rel="stylesheet" href="../assets/brand.css">
    <!-- Confetti Container (Background FX) -->
    <div id="confetti-container" class="absolute inset-0 pointer-events-none z-0"></div>

    <!-- START SCREEN -->
    <div id="start-screen" class="bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-b-8 border-yellow-400 animate-pop z-10 mx-4">
        <div class="mb-6 flex justify-center text-yellow-400 animate-float">
            <!-- Sun/Star Icon -->
            <svg width="100" height="100" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                <circle cx="12" cy="12" r="6" fill="#FFD700"/>
                <path d="M12 2L14 7L19 7L16 11L18 16L13 14L12 14L7 16L9 11L6 7L11 7L12 2Z" fill="#FFA500"/>
            </svg>
        </div>
        <h1 class="text-5xl font-bold text-indigo-600 mb-2 tracking-tight" style="text-shadow: 2px 2px 0px #FFD700;">Time Game!</h1>
        <p class="text-xl text-gray-500 mb-8 font-medium">Learn O'clock & Catch Candy! üç¨</p>
        <button id="start-btn" class="w-full bg-green-500 hover:bg-green-400 text-white text-3xl font-bold py-4 rounded-2xl shadow-lg border-b-8 border-green-700 active:border-b-0 active:translate-y-2 flex items-center justify-center gap-3">
            PLAY ‚ñ∂Ô∏è
        </button>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="hidden flex-col items-center w-full max-w-2xl h-full justify-center z-10 px-4 py-2">
        
        <!-- Header: Level & Sound -->
        <div class="w-full flex justify-between items-center mb-2">
            <div class="bg-white px-4 py-2 rounded-full shadow-md border-2 border-indigo-200">
                <span class="font-bold text-indigo-600 text-lg">Question <span id="level-indicator">1</span>/10</span>
            </div>
            <button id="sound-toggle" class="p-2 bg-white rounded-full shadow-md border-2 border-indigo-200 hover:bg-indigo-50 text-indigo-500">
                <span id="icon-sound" class="text-2xl">üîä</span>
            </button>
        </div>

        <!-- Main Card -->
        <div class="bg-white/95 backdrop-blur-sm p-4 md:p-6 rounded-3xl shadow-xl w-full border-4 border-indigo-200 relative">
            
            <!-- Question with Speaker -->
            <div class="text-center mb-4 flex items-center justify-center gap-3">
                <h2 class="text-3xl md:text-4xl font-bold text-indigo-800">What time is it?</h2>
                <button onclick="speakQuestion()" class="bg-yellow-400 hover:bg-yellow-300 text-white p-2 rounded-full shadow-md border-b-4 border-yellow-600 active:border-b-0 active:translate-y-1 transition-all" title="Listen">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                </button>
            </div>

            <!-- Clock Display -->
            <div class="relative w-56 h-56 md:w-72 md:h-72 mx-auto mb-6 transition-transform hover:scale-105 duration-300">
                <svg viewBox="0 0 200 200" class="w-full h-full drop-shadow-2xl">
                    <!-- Bezel -->
                    <circle cx="100" cy="100" r="95" fill="#FFFFFF" stroke="#FF9F1C" stroke-width="8" />
                    <circle cx="100" cy="100" r="85" fill="#FFF" stroke="#FFBF69" stroke-width="2" />
                    
                    <!-- Rainbow Numbers -->
                    <g class="font-bold text-2xl" style="font-family: 'Fredoka', sans-serif; text-anchor: middle; dominant-baseline: middle;">
                        <!-- Using different colors for numbers to be attractive -->
                        <text x="135" y="39.38" fill="#FF6B6B">1</text>
                        <text x="160.62" y="65" fill="#4ECDC4">2</text>
                        <text x="170" y="100" fill="#45B7D1">3</text>
                        <text x="160.62" y="135" fill="#96CEB4">4</text>
                        <text x="135" y="160.62" fill="#FFBE0B">5</text>
                        <text x="100" y="170" fill="#FF006E">6</text>
                        <text x="65" y="160.62" fill="#8338EC">7</text>
                        <text x="39.38" y="135" fill="#3A86FF">8</text>
                        <text x="30" y="100" fill="#FB5607">9</text>
                        <text x="39.38" y="65" fill="#FF006E">10</text>
                        <text x="65" y="39.38" fill="#8338EC">11</text>
                        <text x="100" y="30" fill="#3A86FF">12</text>
                    </g>

                    <!-- Minute Hand (Blue, Fixed at 12) -->
                    <line x1="100" y1="100" x2="100" y2="30" stroke="#4ECDC4" stroke-width="8" stroke-linecap="round" />
                    <!-- Hour Hand (Red, Rotates) -->
                    <line id="hour-hand" x1="100" y1="100" x2="100" y2="55" stroke="#FF6B6B" stroke-width="10" stroke-linecap="round" />
                    <!-- Center Pin -->
                    <circle cx="100" cy="100" r="8" fill="#FF9F1C" />
                </svg>
            </div>

            <!-- Feedback Area -->
            <div class="h-8 mb-2 flex justify-center items-center">
                <div id="wrong-msg" class="hidden bg-red-100 text-red-500 px-6 py-1 rounded-full font-bold animate-wiggle border-2 border-red-200">
                    ‚ùå Try again!
                </div>
            </div>

            <!-- Answer Buttons -->
            <div id="options-container" class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <!-- JS will fill this -->
            </div>
        </div>
    </div>

    <!-- CANDY GAME OVERLAY -->
    <div id="candy-game-screen" class="hidden fixed inset-0 z-50 flex-col bg-blue-100/90 backdrop-blur-sm cursor-none touch-none overflow-hidden">
        <div class="absolute top-4 left-0 right-0 text-center pointer-events-none">
            <h2 class="text-4xl font-bold text-pink-500 animate-bounce drop-shadow-md">Catch the Candy! üç¨</h2>
            <p class="text-2xl text-blue-500 font-bold">Bonus Round!</p>
        </div>
        
        <!-- Basket -->
        <div id="basket">üß∫</div>

        <!-- Score for Candy Game -->
        <div class="absolute top-4 right-4 bg-white px-4 py-2 rounded-full border-4 border-pink-300 shadow-lg text-2xl font-bold text-pink-500">
            üç¨ <span id="candy-score">0</span>
        </div>
    </div>

    <!-- SUCCESS MESSAGE (Pre-Next Level) -->
    <div id="next-level-overlay" class="hidden fixed inset-0 z-40 bg-black/50 flex items-center justify-center">
        <div class="bg-white p-8 rounded-3xl shadow-2xl animate-pop text-center max-w-sm w-full border-4 border-green-400">
            <div class="text-6xl mb-4">üåü</div>
            <h2 class="text-3xl font-bold text-green-600 mb-2">Awesome!</h2>
            <p id="level-summary" class="text-xl text-gray-500 mb-6">You got lots of candy!</p>
            <button id="next-btn" class="w-full bg-indigo-500 hover:bg-indigo-400 text-white text-2xl font-bold py-3 rounded-xl border-b-4 border-indigo-700 active:border-b-0 active:translate-y-1">
                Next Question ‚û°
            </button>
        </div>
    </div>

    <!-- END SCREEN -->
    <div id="end-screen" class="hidden bg-white p-8 rounded-3xl shadow-2xl max-w-md w-full text-center border-b-8 border-yellow-400 animate-pop z-10 mx-4">
        <div class="text-8xl mb-4 animate-bounce">üèÜ</div>
        <h2 class="text-4xl font-bold text-indigo-600 mb-2">You are a Star! ‚≠ê</h2>
        <p class="text-2xl text-gray-500 mb-6">Completed all 10 clocks!</p>
        <p class="text-xl text-pink-500 font-bold mb-8">Total Candies: <span id="total-candies">0</span> üç¨</p>
        <button id="restart-btn" class="w-full bg-blue-500 hover:bg-blue-400 text-white text-2xl font-bold py-4 rounded-2xl shadow-lg border-b-8 border-blue-700 active:border-b-0 active:translate-y-2">
            Play Again üîÑ
        </button>
    </div>

    <script>
        // --- Audio Context & Synthesis ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function speakQuestion() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance("What time is it?");
                utterance.lang = 'en-US';
                utterance.rate = 0.9; // Slightly slower for kids
                utterance.pitch = 1.1; // Cheerful pitch
                window.speechSynthesis.speak(utterance);
            }
        }

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                // Happy magical chime
                osc.type = 'sine';
                osc.frequency.setValueAtTime(523.25, now);
                osc.frequency.exponentialRampToValueAtTime(1046.5, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'wrong') {
                // Gentle error
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(150, now + 0.2);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'pop') {
                // Bubble pop for candy
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(1200, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'win') {
                // Victory Fanfare
                osc.type = 'square';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.setValueAtTime(440, now + 0.1);
                osc.frequency.setValueAtTime(440, now + 0.2);
                osc.frequency.setValueAtTime(659, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 1.0);
                osc.start(now);
                osc.stop(now + 1.0);
            }
        }

        // --- Game State ---
        let round = 1;
        const totalRounds = 10;
        let targetHour = 3;
        let totalCandiesCollected = 0;
        let currentCandies = 0;

        // --- Elements ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const optionsContainer = document.getElementById('options-container');
        const hourHand = document.getElementById('hour-hand');
        const levelIndicator = document.getElementById('level-indicator');
        const wrongMsg = document.getElementById('wrong-msg');
        
        // Candy Game Elements
        const candyGameScreen = document.getElementById('candy-game-screen');
        const basket = document.getElementById('basket');
        const candyScoreEl = document.getElementById('candy-score');
        const nextLevelOverlay = document.getElementById('next-level-overlay');
        const levelSummary = document.getElementById('level-summary');

        // --- Helper Functions ---
        function numberToWord(num) {
            const words = ["", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve"];
            return words[num];
        }

        // --- Core Game Logic ---
        function initGame() {
            round = 1;
            totalCandiesCollected = 0;
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');
            
            // Try to speak first time to unlock audio
            speakQuestion(); 
            loadRound();
        }

        function loadRound() {
            wrongMsg.classList.add('hidden');
            nextLevelOverlay.classList.add('hidden');
            levelIndicator.textContent = round;
            
            targetHour = Math.floor(Math.random() * 12) + 1;
            hourHand.style.transform = `rotate(${targetHour * 30}deg)`;

            // Generate Options
            const correctOption = targetHour;
            const opts = new Set([correctOption]);
            while (opts.size < 3) opts.add(Math.floor(Math.random() * 12) + 1);
            const shuffled = Array.from(opts).sort(() => Math.random() - 0.5);

            optionsContainer.innerHTML = '';
            shuffled.forEach(opt => {
                const btn = document.createElement('button');
                // Updated Button Styles for "Colorful" look
                const colors = ['bg-pink-500 border-pink-700', 'bg-blue-500 border-blue-700', 'bg-purple-500 border-purple-700', 'bg-orange-500 border-orange-700'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                btn.className = `game-btn ${randomColor} text-white w-full p-4 rounded-2xl relative overflow-hidden group hover:brightness-110`;
                btn.innerHTML = `
                    <div class="text-3xl font-bold mb-1 pointer-events-none drop-shadow-md">${opt}:00</div>
                    <div class="text-lg opacity-90 font-medium pointer-events-none">${numberToWord(opt)} o'clock</div>
                `;
                btn.onclick = () => handleAnswer(opt, btn);
                optionsContainer.appendChild(btn);
            });
        }

        function handleAnswer(selected, btn) {
            if (selected === targetHour) {
                playSound('correct');
                // Trigger Candy Game!
                startCandyGame();
            } else {
                playSound('wrong');
                wrongMsg.classList.remove('hidden');
                btn.classList.add('opacity-50', 'cursor-not-allowed', 'grayscale');
                btn.disabled = true;
                setTimeout(() => wrongMsg.classList.add('hidden'), 1500);
            }
        }

        // --- Candy Mini Game Logic ---
        let candyInterval;
        let gameLoopAnim;
        let activeCandies = [];
        let basketX = window.innerWidth / 2;
        let isCandyGameRunning = false;

        function startCandyGame() {
            isCandyGameRunning = true;
            currentCandies = 0;
            candyScoreEl.textContent = "0";
            
            // Hide Main Game, Show Candy Overlay
            gameScreen.classList.remove('flex');
            gameScreen.classList.add('hidden');
            candyGameScreen.classList.remove('hidden');
            candyGameScreen.classList.add('flex');
            
            // Reset Basket
            basketX = window.innerWidth / 2;
            updateBasketPos();

            // Start Spawning
            candyInterval = setInterval(spawnCandy, 400); // New candy every 0.4s
            gameLoopAnim = requestAnimationFrame(updateCandyGame);

            // End game after 5 seconds
            setTimeout(endCandyGame, 5000);
        }

        function endCandyGame() {
            isCandyGameRunning = false;
            clearInterval(candyInterval);
            cancelAnimationFrame(gameLoopAnim);
            
            // Clear candies
            activeCandies.forEach(c => c.element.remove());
            activeCandies = [];

            // Add to total
            totalCandiesCollected += currentCandies;

            // Show Summary
            candyGameScreen.classList.add('hidden');
            candyGameScreen.classList.remove('flex');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('flex');
            
            levelSummary.textContent = `You caught ${currentCandies} candies! üç¨`;
            nextLevelOverlay.classList.remove('hidden');
            playSound('win');
        }

        function spawnCandy() {
            const types = ['üç¨', 'üç≠', 'üç´', 'üç™', 'üç©'];
            const type = types[Math.floor(Math.random() * types.length)];
            const el = document.createElement('div');
            el.className = 'candy';
            el.textContent = type;
            el.style.left = Math.random() * (window.innerWidth - 50) + 'px';
            el.style.top = '-50px';
            candyGameScreen.appendChild(el);
            
            activeCandies.push({
                element: el,
                x: parseFloat(el.style.left),
                y: -50,
                speed: 3 + Math.random() * 4 // Random speed
            });
        }

        function updateCandyGame() {
            if (!isCandyGameRunning) return;

            // Move Candies
            for (let i = activeCandies.length - 1; i >= 0; i--) {
                const c = activeCandies[i];
                c.y += c.speed;
                c.element.style.top = c.y + 'px';

                // Check collision with basket
                const basketRect = basket.getBoundingClientRect();
                const candyRect = c.element.getBoundingClientRect();

                // Simple AABB Collision
                if (
                    candyRect.bottom >= basketRect.top + 20 &&
                    candyRect.right >= basketRect.left &&
                    candyRect.left <= basketRect.right &&
                    candyRect.top < basketRect.bottom
                ) {
                    // Caught!
                    currentCandies++;
                    candyScoreEl.textContent = currentCandies;
                    playSound('pop');
                    c.element.remove();
                    activeCandies.splice(i, 1);
                } 
                // Missed (out of screen)
                else if (c.y > window.innerHeight) {
                    c.element.remove();
                    activeCandies.splice(i, 1);
                }
            }

            requestAnimationFrame(updateCandyGame);
        }

        function updateBasketPos() {
            // Keep basket within screen bounds
            const limit = window.innerWidth;
            if (basketX < 40) basketX = 40;
            if (basketX > limit - 40) basketX = limit - 40;
            basket.style.left = basketX + 'px';
        }

        // Mouse/Touch Move for Basket
        window.addEventListener('mousemove', (e) => {
            if (isCandyGameRunning) {
                basketX = e.clientX;
                updateBasketPos();
            }
        });
        window.addEventListener('touchmove', (e) => {
            if (isCandyGameRunning) {
                basketX = e.touches[0].clientX;
                updateBasketPos();
            }
        }, { passive: false });


        // --- Navigation ---
        document.getElementById('start-btn').addEventListener('click', initGame);
        
        document.getElementById('next-btn').addEventListener('click', () => {
            if (round >= totalRounds) {
                nextLevelOverlay.classList.add('hidden');
                gameScreen.classList.add('hidden');
                gameScreen.classList.remove('flex');
                document.getElementById('total-candies').textContent = totalCandiesCollected;
                endScreen.classList.remove('hidden');
                playSound('win');
            } else {
                round++;
                loadRound();
            }
        });

        document.getElementById('restart-btn').addEventListener('click', initGame);

    </script>
</body>
</html>
